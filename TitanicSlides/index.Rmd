---
title       : Titanic Passenger Survival
subtitle    : Using data cleaning, random forests, and logistic regression to predict passenger survival on the RMS Titanic
author      : Antonio Skilton
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

## training_data Data
```{r,echo=FALSE}
training_data <- read.csv("data/train.csv")
survived_label <- ifelse(training_data$Survived==1,"survived","died")
training_data$Cabin[training_data$Cabin==""] <- NA
```
```{r,echo=FALSE}
str(training_data)
```

---

```{r, message=TRUE, warning=FALSE,echo=FALSE, include=TRUE}
library(VIM)
plot(aggr(training_data, col=c('navyblue','red'), numbers=TRUE, labels=names(training_data), sortVars=TRUE, cex.axis=.7,prop=TRUE, gap=3, ylab=c("Histogram of missing data","Pattern")))
```


--- .class #id 

## Name/Title
#### The names all have some title associated with them:

```{r}
training_data$Name[1:9]
```


---

## Name/Title
#### For most passengers we can produce a category related to title:
```{r}
training_data$title <- NA
attach(training_data)


for(string in c("master","mr","miss","mrs")) {
  training_data$title[grepl(string,Name,ignore.case=T)] <- string 
}
detach(training_data)
```
#### And we assume that all with alternate titles are adults and assign them titles based on sex
```{r}
attach(training_data)
training_data$title[is.na(title)]<-ifelse(Sex[is.na(title)]=="female","mrs","mr")
detach(training_data)
```
```{r,echo=FALSE}
detach(training_data)
```

--- 

## Name/Title
#### Which gives us the following result:

```{r, message=FALSE, warning=FALSE}
training_data[1:9,c("Name","title")]
```

---

## Name/Title
#### Is there a pattern our models could use to predict survival?
```{r, message=FALSE, warning=FALSE, include=FALSE}
library(googleVis)
```
```{r, message=FALSE, warning=FALSE, echo=FALSE}
table(survived_label,training_data$title)
library(dplyr)
df <- training_data %>% group_by(title) %>% summarize(prcnt=mean(Survived), prcnt.html.tooltip=n()) %>%filter(!is.na(title)) %>% mutate(prcnt.certainty=c(TRUE,FALSE,TRUE,FALSE))
p<-gvisColumnChart(df,xvar="title",yvar=c("prcnt","prcnt.certainty"),options=list(legend='none',
  title="In-Group Survival Rate by Title")
  )
```
```{r gv, echo=FALSE, message=FALSE, warning=FALSE, results='asis',fig.align='center',fig.height=20}
print(p,"chart")
```

###### Clearly, adult men are fare less likely than either adult women or children of either gender to have survived the Titanic.

---

## Ticket
#### We have a similar text issue with ticket number ...

```{r}
training_data$Ticket[1:40]
```

---

## Ticket Number
#### ... which we can solve with the gsub function:
```{r, message=FALSE, warning=FALSE}
attach(training_data)
training_data$Ticket_numeric <- as.numeric(gsub("[^0-9]","",Ticket))
```
```{r,echo=FALSE}
training_data$Ticket_numeric[training_data$Ticket_numeric==3] <- NA
detach(training_data)
```
```{r}
training_data[1:9,c("Ticket","Ticket_numeric")]
```
```{r,echo=FALSE}
training_data$Ticket_numeric[training_data$Ticket_numeric==3 | training_data$Ticket_numeric > 2500000] <- NA
```

---
## Ticket Number
#### To find patterns in the assignment of ticket numbers, we plot a histogram
```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(ggplot2)
ggplot(training_data,aes(Ticket_numeric)) + 
  geom_histogram()
```

---


```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.align='center',fig.width=12,fig.height=6}
training_data$Ticket_numeric[training_data$Ticket_numeric==3] <- NA
training_data$Ticket_group[training_data$Ticket_numeric < 300000] <- "lowTicketNumber"
training_data$Ticket_group[training_data$Ticket_numeric >= 300000] <- "highTicketNumber"
library(caret)
training_data <- cbind(training_data,predict(dummyVars(~Ticket_group, data = training_data), newdata = training_data))
df <- training_data %>% select(Ticket_group,Ticket_numeric) %>% na.omit()
library(ggplot2)
ggplot(training_data,aes(Ticket_numeric,fill=Ticket_group)) +
  geom_histogram(binwidth=5000) 
table(survived_label,training_data$Ticket_group)
```

---

```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.align='center',fig.width=12,fig.height=6}
training_data$Ticket_group[training_data$Ticket_numeric < 300000] <- "lowTicketNumber"
training_data$Ticket_group[training_data$Ticket_numeric >= 300000] <- "highTicketNumber"
library(caret)
training_data <- cbind(training_data,predict(dummyVars(~Ticket_group, data = training_data), newdata = training_data))
df <- training_data %>% select(Ticket_group,Ticket_numeric) %>% na.omit()
library(ggplot2)
ggplot(training_data,aes(Ticket_numeric,fill=Ticket_group)) +
  geom_histogram(binwidth=5000) +
  theme(legend.position="top")
table(survived_label,training_data$Ticket_group)
```



---

```{r, message=FALSE, warning=FALSE, echo=FALSE,fig.align='center',fig.width=12,fig.height=6}
training_data$Ticket_numeric[training_data$Ticket_numeric==3] <- NA
training_data$Ticket_group[training_data$Ticket_numeric < 300000] <- "lowTicketNumber"
training_data$Ticket_group[training_data$Ticket_numeric >= 300000] <- "highTicketNumber"
library(caret)
training_data <- cbind(training_data,predict(dummyVars(~Ticket_group, data = training_data), newdata = training_data))
df <- training_data %>% select(Ticket_group,Ticket_numeric) %>% na.omit()
library(ggplot2)
ggplot(training_data,aes(Ticket_numeric,fill=Ticket_group)) +
  geom_histogram(binwidth=5000) +
  theme(legend.position="top")
table(survived_label,training_data$Ticket_group)
```